/*
 * Copyright (C) Contributors to the Suwayomi project
 */

 body {
    margin: 0;
}

:root {
    --ocr-accent: #4890ff;
    --ocr-bg: #ffffff;
    --ocr-text-color: #000000;
    --ocr-opacity: 0.3;
    --ocr-scale: 1.05;
}

/* --- SCROLLING LOGIC --- */
html, body {
    margin: 0;
    padding: 0;
}

html.ocr-reader-mode, 
html.ocr-reader-mode body {
    overflow: hidden !important;
    height: 100%;
}

/* --- OVERLAYS --- */
.ocr-overlay-container { pointer-events: none; z-index: 99999; }

/* --- TEXT BOX CARD STYLING --- */
.gemini-ocr-text-box {
    position: absolute;
    
    /* CRITICAL FIX: FORCE BLOCK DISPLAY. 
       We use !important to strictly override any flex behavior. */
    display: block !important;
    
    /* Reset alignment for standard text flow */
    text-align: center;
    
    /* Ensure the box fits the text tightly */
    width: fit-content;
    height: fit-content;
    
    /* Standard Styles */
    background-color: var(--ocr-bg);
    border: 1px solid #ccc;
    border-radius: 3px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    color: var(--ocr-text-color);
    padding: 4px;
    
    /* Font & Text Settings */
    font-family: 'Noto Sans JP', sans-serif;
    font-weight: 600;
    line-height: 1.5; 
    white-space: pre;  
    overflow: visible; 
    box-sizing: border-box; 
    
    /* Interactive Settings */
    cursor: text;
    user-select: text !important;
    pointer-events: auto !important;
    
    /* FIX: Removed transform transition to prevent coordinate drift */
    transition: opacity 0.2s;
    opacity: 1; 
    
    /* Ensure minimum size for interaction */
    min-width: 20px;
    min-height: 20px;
}

/* FIX: iOS requires cursor: pointer to treat a div as a 'clickable' element instantly. */
.mobile-mode .gemini-ocr-text-box {
    cursor: pointer !important;
    user-select: none;
    -webkit-user-select: none;
}

/* FIX: Re-enable text selection only when the box is active (Blue) */
.gemini-ocr-text-box.mobile-active {
    user-select: text !important;
    -webkit-user-select: text !important;
    cursor: text !important;
}

/* FIX: Vertical Mode Adjustment */
.gemini-ocr-text-box.vertical {
    writing-mode: vertical-rl;
    text-orientation: upright;
    
    /* In vertical-rl, 'left' aligns text to the top of the column */
    text-align: left; 
    
    /* SAFETY: Ensure no flex properties linger */
    align-items: unset !important;
    justify-content: unset !important;
}

/* FIX: HOVER STATE (STABLE) */
/* Wrapped in hover media query to prevent sticky hover states on mobile */
@media (hover: hover) {
    .gemini-ocr-text-box:hover {
        z-index: 100000;
        transform: none !important;
        outline: 2px solid var(--ocr-accent);
        border: 1px solid #ccc; 
        padding: 4px;           
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        opacity: 1 !important; 
    }
}

/* FIX: CUSTOM SELECTION COLOR
   This styles the native browser highlight (window.getSelection) 
   to match your app's theme. */
.gemini-ocr-text-box::selection {
    background: rgba(72, 144, 255, 0.4); 
    color: inherit;
}

.gemini-ocr-text-box.editing {
    z-index: 200000 !important;
    background: white !important;
    border: 2px solid #3498db;
    overflow: auto; 
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding: 4px;
    
    /* Ensure editing mode also uses block display */
    display: block !important;
    text-align: left;
    
    opacity: 1 !important; 
    user-select: text !important;
}

.gemini-ocr-text-box.editing::-webkit-scrollbar { display: none; }
.gemini-ocr-text-box.merge-target { outline: 3px solid #f1c40f; z-index: 100000; opacity: 1 !important; }

/* SOLO MODE LOGIC */
.ocr-overlay-container.solo-mode .gemini-ocr-text-box { opacity: 0; }
.ocr-overlay-container.solo-mode .gemini-ocr-text-box:hover { opacity: 1 !important; }

/* CRITICAL FIX: PREVENT FLASHING ON MOBILE
   When in solo-mode, if a box is ACTIVE (Blue), force it to stay visible (Opacity 1). */
.ocr-overlay-container.solo-mode .gemini-ocr-text-box.mobile-active {
    opacity: 1 !important;
}

/* NEW FIX: PREVENT FLASHING ON DESKTOP
   If the dictionary is open and this box is the active target, force visibility.
   This fixes the issue where the backdrop covers the box, removing the hover state. */
.ocr-overlay-container.solo-mode .gemini-ocr-text-box.active-lookup {
    opacity: 1 !important;
}

/* --- SETTINGS MODAL STYLES --- */
.ocr-modal-overlay { 
    position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
    background: rgba(0, 0, 0, 0.7); 
    z-index: 2147483647; 
    display: flex; align-items: center; justify-content: center; 
    padding: 20px; 
}

.ocr-modal { 
    background: #1a1d21; color: #eaeaea; 
    width: 600px; max-width: 95vw; 
    max-height: 90vh; 
    display: flex; flex-direction: column;
    border: 1px solid var(--ocr-accent); 
    box-shadow: 0 10px 25px rgba(0,0,0,0.5); 
}

.ocr-modal-header { padding: 15px 20px; border-bottom: 1px solid #333; flex-shrink: 0; }
.ocr-modal-content { padding: 20px; flex-grow: 1; overflow-y: auto; min-height: 0; }

.ocr-modal-footer { 
    padding: 15px 20px; 
    border-top: 1px solid #333; 
    background: #15171a; 
    display: flex; 
    justify-content: flex-end; 
    gap: 10px; 
    flex-shrink: 0;
    flex-wrap: wrap; 
}

@media (max-width: 600px) {
    .ocr-modal-footer button {
        flex: 1 0 45%; 
        text-align: center;
        margin-bottom: 5px;
    }
}

.ocr-modal .grid { display: grid; grid-template-columns: 120px 1fr; gap: 10px 15px; margin-bottom: 20px; align-items: center; }
.ocr-modal input, .ocr-modal select, .ocr-modal textarea { background: #2a2a2e; color: white; border: 1px solid #555; padding: 8px; width: 100%; box-sizing: border-box; }


.ocr-modal-footer button { padding: 8px 16px; border-radius: 4px; border: 1px solid #444; background: #2a2a2e; color: white; cursor: pointer; }
.ocr-modal-footer button.primary { background-color: #27ae60; border-color: #219150; }
.ocr-modal-footer button.danger { background-color: #c0392b; border-color: #a93226; }
.ocr-modal-footer button.warning { background-color: #e67e22; border-color: #d35400; }
.mobile-mode .gemini-ocr-text-box { transition: none !important; animation: none !important; }

/* --- GLOBAL DIALOG STYLES --- */
.ocr-global-dialog-overlay {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    z-index: 2147483648; 
    display: flex; align-items: center; justify-content: center;
    padding: 20px;
}

.ocr-global-dialog {
    background: #25282d;
    color: #fff;
    border: 1px solid #555;
    border-radius: 8px;
    padding: 20px;
    width: 400px;
    max-width: 90vw;
    box-shadow: 0 20px 50px rgba(0,0,0,0.7);
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.ocr-global-dialog h3 { margin: 0 0 10px 0; font-size: 1.2rem; }
.ocr-global-dialog p { margin: 0; line-height: 1.5; color: #ccc; }

.ocr-dialog-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 10px;
}

.ocr-dialog-actions button {
    padding: 8px 20px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    font-weight: bold;
}

.ocr-dialog-btn-confirm { background: #27ae60; color: white; }
.ocr-dialog-btn-cancel { background: #444; color: white; }

.ocr-dialog-spinner {
    border: 4px solid #444;
    border-top: 4px solid var(--ocr-accent);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: rotate 1s linear infinite;
    margin: 10px auto;
}

/* --- HIDE OCR OVERLAY WHEN SUWAYOMI READING OPTIONS ARE OPEN --- */
body:has(.MuiDialog-root) .ocr-overlay-container,
body:has(.MuiDialogContent-root) .ocr-overlay-container {
    display: none !important;
    pointer-events: none !important;
}

/* --- HIDE OCR OVERLAY WHEN CROPPER MODAL OR SETTINGS MODAL IS OPEN --- */
body:has(.ocr-modal) .ocr-overlay-container {
    display: none !important;
    pointer-events: none !important;
}

/* --- STATUS ICON --- */
.ocr-status-icon-container {
    position: absolute; top: 15px; right: 15px; z-index: 200000; 
    width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
    background: rgba(255, 255, 255, 0.9); border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    pointer-events: auto; transition: opacity 0.3s;
}
.ocr-retry-button { background: none; border: none; padding: 0; cursor: pointer; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; transition: transform 0.2s; }
.ocr-retry-button:hover { transform: scale(1.15); }
.ocr-retry-button svg { width: 20px; height: 20px; }
.ocr-spinner { animation: rotate 2s linear infinite; width: 20px; height: 20px; }
.ocr-spinner .path { stroke: var(--ocr-accent); stroke-linecap: round; animation: dash 1.5s ease-in-out infinite; }
@keyframes rotate { 100% { transform: rotate(360deg); } }
@keyframes dash { 0% { stroke-dasharray: 1, 150; stroke-dashoffset: 0; } 50% { stroke-dasharray: 90, 150; stroke-dashoffset: -35; } 100% { stroke-dasharray: 90, 150; stroke-dashoffset: -124; } }

/* Chapter Process Buttons */
.ocr-chapter-btn { font-family: 'Roboto', sans-serif; font-size: 0.75rem; font-weight: 500; padding: 4px 12px; border-radius: 4px; border: 1px solid; cursor: pointer; transition: all 0.2s; background: transparent; text-transform: uppercase; line-height: 1.5; }
.ocr-chapter-btn.process { color: var(--ocr-accent); border-color: var(--ocr-accent); }
.ocr-chapter-btn.process:hover { background-color: rgba(72, 144, 255, 0.1); }
.ocr-chapter-btn.process.busy { opacity: 0.7; cursor: wait; }
.ocr-chapter-btn.done { color: #27ae60; border-color: #27ae60; background-color: rgba(39, 174, 96, 0.1); cursor: default; }
.ocr-chapter-btn.loading { border: none; color: #888; }
.yomitan-ghost-text { min-width: 1ch; display: inline-block; user-select: none !important; pointer-events: none !important; }
.yomitan-ghost-text::after { content: attr(data-text); visibility: visible; }
